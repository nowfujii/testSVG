<!DOCTYPE html><html lang="ja" dir="ltr">  <head>    <meta charset="utf-8">    <title>Leaflet日本地図</title>  </head><!-- leaflet -->  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script><!-- ICON plugin -->  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"><!-- easy button-->  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">  <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script><!-- point in polygon for Leaflet https://github.com/mapbox/leaflet-pip-->  <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script><!-- TileLayer.PouchDBCached https://github.com/MazeMap/Leaflet.TileLayer.PouchDBCached--><!--  <script src="https://unpkg.com/pouchdb@^5.2.0/dist/pouchdb.js"></script>  <script src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@latest/L.TileLayer.PouchDBCached.js"></script>--><!-- 日本地図GeoJson/　都道府県データpref-->  <link rel="stylesheet" href="index2.css">  <!--<link rel="stylesheet" href="https://nowfujii.github.io/testSVG/index2.css">-->  <script src="index2.js"></script>  <!--htmlファイルと同じ名前だと読み込んでいる！ので、.jsはここに統合した-->  <!--<script src="https://nowfujii.github.io/testSVG/index2.js"></script>-->  <!--  <script src="pref.js" ></script> ローカルファイルを読み込んでくれない-->  <!--<script src="https://nowfujii.github.io/testSVG/pref.js"></script>-->  <body>    <!--背景色用-->    <div id="nuri"></div>    <!--地図用-->    <div id="map">    <!--十字マーク-->      <div id="cross">        <IMG id="_cross" src="https://maps.gsi.go.jp/image/map/crosshairs.png" style="visibility: hidden">  <!--visilbe / hidden-->      </div>    </div>  </body></html><script type="text/javascript">  //初期表示位置とズーム設定　（大阪府大阪市）  var id             = 0;                   //都道府県ID  var pref           = "";                  //都道府県名  var lat            = 34.6878788;          //緯度  var lng            = 135.5060062;         //経度  var jlat           = 34.6878788;          //日本地図大阪　緯度  var jlng           = 135.5060062;         //日本地図大阪　経度  var wlat           = 21.453068633086783;  //世界地図中心　緯度  var wlng           = 9.316406250000002;    //世界地図中心　経度  var zoom           = 6;                   //ズーム  var maptype        = 0;                   //ベース地図種類 0:地-白、1:地-標準、2:地-単色、3:地-写真、4:OSM-JP、5:OSM-ORG、6,G-標準、7:G-道路、8:G-写真、9:G-ハイブリッド  var localnameFlg   = true;                //地方名色別         true:ON false:OFF  var transparentFlg = false;               //選択時不透明       true:ON false:OFF  var gpsmarkerFlg   = false;               //現在地マーカー     true:ON false:OFF  var prefmarkerFlg  = false;               //県庁所在地マーカー true:ON false:OFF  var popupFlg       = true;                //ポップアップ表示   true:ON false:OFF  var stateFlg       = true;                //６大州色別         true:ON false:OFF  var capitalFlg     = false;               //首都マーカー       true:ON false:OFF  //urlパラメータ取得  if (getParam('id') > 0 && getParam('id') < 48){    id    = getParam('id');                              //index2.html?id=1    pref  = prefJson.marker[id-1].pref;    lat   = prefJson.marker[id-1].lat2;    lng   = prefJson.marker[id-1].lng2;    zoom  = prefJson.marker[id-1].zoom;    console.log("id:" + id + " 都道府県:" + pref + " lat:" + lat + " lng:" + lng + "zoom:" + zoom);  }  if (getParam('zoom') > 1 && getParam('zoom') < 23 && getParam('zoom') != null){    zoom = getParam('zoom');                            //index2.html?zoom=6    console.log("zoom:"+zoom);  }  if (getParam('maptype') >= 0 && getParam('maptype') < 10 && getParam('maptype') != null){    maptype = getParam('maptype');    console.log("maptype:" + maptype);  }  if (getParam('localnameFlg') == 'true'){    localnameFlg = true;    console.log("localnameFlg:" + localnameFlg);  } else if (getParam('localnameFlg') == 'false'){    localnameFlg = false;    console.log("localnameFlg:" + localnameFlg);  }  if (getParam('transparentFlg') == 'true'){    transparentFlg = true;    console.log("transparentFlg:" + transparentFlg);  } else   if (getParam('transparentFlg') == 'false'){    transparentFlg = false;    console.log("transparentFlg:" + transparentFlg);  }  if (getParam('gpsmarkerFlg') == 'true'){    gpsmarkerFlg = true;    console.log("gpsmarkerFlg:" + gpsmarkerFlg);  } else   if (getParam('gpsmarkerFlg') == 'false'){    gpsmarkerFlg = false;    console.log("gpsmarkerFlg:" + gpsmarkerFlg);  }  if (getParam('prefmarkerFlg') == 'true'){    prefmarkerFlg = true;    console.log("prefmarkerFlg:" + prefmarkerFlg);  } else if (getParam('prefmarkerFlg') == 'false'){    prefmarkerFlg = false;    console.log("prefmarkerFlg:" + prefmarkerFlg);  }  if (getParam('popupFlg') == 'true'){    popupFlg = true;    console.log("popupFlg:" + popupFlg);  } else   if (getParam('popupFlg') == 'false'){    popupFlg = false;    console.log("popupFlg:" + popupFlg);  }  if (getParam('stateFlg') == 'true'){    stateFlg = true;    console.log("stateFlg:" + stateFlg);  } else   if (getParam('stateFlg') == 'false'){    stateFlg = false;    console.log("stateFlg:" + stateFlg);  }  //アイコン設定  var myIcon    = L.divIcon({className: 'my-div-icon'});  //cssにて影付きの小さな白い正方形をセット（leafret.cssに設定されている）  var crossIcon = L.icon({ iconUrl: 'https://maps.gsi.go.jp/image/map/crosshairs.png' , iconSize: [64, 64], iconAnchor: [32, 32] });  var closeIcon = L.icon({ iconUrl: 'https://maps.gsi.go.jp/image/system/close.png'   , iconSize: [64, 64], iconAnchor: [32, 32] });  var viewIcon  = L.icon({ iconUrl: 'https://maps.gsi.go.jp/image/system/view.png'    , iconSize: [64, 64], iconAnchor: [32, 32] });  //ベースレイヤー：地理院地図　白地図タイル  var gsiwhite = new L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png', {    attribution:  "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>©国土地理院:白地図</a>",    id:           '地理院地図:白地図', minNativeZoom:2, maxNativeZoom: 18, minZoom: 4, maxZoom:14, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：地理院地図 標準地図タイル  var gsi = new L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {    attribution:  "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>©国土地理院:標準地図</a>",    id:           '地理院地図:標準', minNativeZoom:1, maxNativeZoom: 18, minZoom: 1, maxZoom:25, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：地理院地図 淡色地図タイル  var gsipale = new L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {    attribution:  "<a href='http://portal.cyberjapan.jp/help/termsofuse.html' target='_blank'>©国土地理院:淡色地図</a>",    id:           '地理院地図：淡色地図', minNativeZoom:1, maxNativeZoom: 17, minZoom: 1, maxZoom:25, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：地理院地図　航空写真タイル  var gsiphoto = new L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg',{    attribution:  "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>©国土地理院:航空写真</a>",    id:           '地理院地図:最新写真', minNativeZoom:2, maxNativeZoom: 18, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：OpenStreetMap(JP) タイル  var osm_jp = new L.tileLayer('https://tile.openstreetmap.jp/{z}/{x}/{y}.png', {    attribution:  "<a href='https://osm.org/copyright' target='_blank'>©OpenStreetMap</a> ©contributors:標準(JP)",    id:           'OpenStreetMap(JP)', minNativeZoom:2, maxNativeZoom: 21, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：OpenStreetMap(ORG) タイル  var osm_org = new L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {    attribution:  "<a href='https://osm.org/copyright' target='_blank'>©OpenStreetMap</a> ©contributors:標準(ORG)",    id:           'OpenStreetMap(ORG)', minNativeZoom:2, maxNativeZoom: 18, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  //ベースレイヤー：Google Map  var g_map = new L.tileLayer('https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}', {    attribution:  "<a href='https://developers.google.com/maps/documentation' target='_blank'>©Google:標準地図</a>",    id:           'GoogleMap:標準', minNativeZoom:2, maxNativeZoom: 21, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  var g_roadmap = new L.tileLayer('https://mt1.google.com/vt/lyrs=h&x={x}&y={y}&z={z}', {    attribution:  "<a href='https://developers.google.com/maps/documentation' target='_blank'>©Google:道路地図</a>",    id:           'GoogleMap:道路', minNativeZoom:2, maxNativeZoom: 21, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  var g_satelite = new L.tileLayer('http://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}', {    attribution:  "<a href='https://developers.google.com/maps/documentation' target='_blank'>©Google:衛星写真</a>",    id:           'GoogleMap:衛星写真', minNativeZoom:2, maxNativeZoom: 21, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: false,  });  var g_hybrid = new L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {    attribution:  "<a href='https://developers.google.com/maps/documentation' target='_blank'>©Google:ハイブリッド地図</a>",    id:           'GoogleMap:ハイブリッド', minNativeZoom:2, maxNativeZoom: 21, minZoom: 2, maxZoom:25, //useCache: true, crossOrigin: true,  });  //baseMapsオブジェクトのプロパティに複数のベースレイヤーを設定  var baseMaps = {    "<span style='font-size:40px'>地理院地図:白地図</span>" :         gsiwhite,    "<span style='font-size:40px'>地理院地図:標準地図</span>" :       gsi,    "<span style='font-size:40px'>地理院地図:淡色地図</span>" :       gsipale,    "<span style='font-size:40px'>地理院地図:写真</span>" :           gsiphoto,    "<span style='font-size:40px'>OpenStreetMap(JP)</span>"  :        osm_jp,    "<span style='font-size:40px'>OpenStreetMap(ORG)</span>"  :       osm_org,    "<span style='font-size:40px'>Google Map:標準</span>"  :          g_map,    "<span style='font-size:40px'>Google Map:道路</span>"  :          g_roadmap,    "<span style='font-size:40px'>Google Map:衛星写真</span>"  :      g_satelite,    "<span style='font-size:40px'>Google Map:ハイブリッド</span>"  :  g_hybrid,  };  //leaflet初期設定  var map = L.map('map', { attributionControl: false, zoomControl: false, zoomSnap: 0.1 }).setView([jlat, jlng], zoom);  //標準ズームをキャンセルし、ズーム間隔を細かくします  L.control.attribution({ position: 'bottomleft'}).addTo(map);  //著作表示：左下（標準だと右下）  //ベース地図初期設定  switch(maptype){    case "1": gsi.addTo(map);       break;    case "2": gsipale.addTo(map);   break;    case "3": gsiphoto.addTo(map);  break;    case "4": osm_jp.addTo(map);    break;    case "5": osm_org.addTo(map);   break;    case "6": g_map.addTo(map);     break;    case "7": g_roadmap.addTo(map); break;    case "8": g_satelite.addTo(map); break;    case "9": g_hybrid.addTo(map);  break;    default:  gsiwhite.addTo(map);  break;  }  //スケール表示  L.control.scale({ maxWidth: 500, position: 'topleft', metric: true, imperial: false, updateWhenIdle: false }).addTo(map);  //ズームボタン  L.control.zoom({ position: 'bottomright' , zoomInTitle: 'ズームイン', zoomOutTitle: 'ズームアウト'}).addTo(map);  //地図表示全体表示ボタン  L.easyButton({      position: 'bottomright', // topleft, topright, bottomleft, bottomright      states: [{                stateName: 'zoom-to-japan',           // 状態のIDのようなもの                icon:      'fas fa-map-marker-alt',   // 使用するアイコン https://fontawesome.com/icons?d=gallery&p=2&m=free                title:     '日本全体',                // マウスオーバー時にツールチップに表示される名前                onClick: function(btn, map) {                    map.setView([jlat,jlng],5);       // 日本地図の中心（大阪）                    btn.state('zoom-to-world');}      // ボタンクリック後の状態を指定               },               {                stateName: 'zoom-to-world',           // 状態のIDのようなもの                icon:      'fas fa-globe',            // 使用するアイコン https://fontawesome.com/icons?d=gallery&p=2&m=free                title:     '世界全体',                // マウスオーバー時にツールチップに表示される名前                onClick: function(btn, map) {                    map.setView([wlat,wlng],2);       // 世界地図の中心位置                    btn.state('zoom-to-japan');}      // ボタンクリック後の状態を指定               }]  }).addTo( map );  //レイヤーグループ  var geoJsonGroup = new L.layerGroup();  var worldJsonGroup = new L.layerGroup();  var markerGroup  = new L.layerGroup();  var wdMarkerGroup  = new L.layerGroup();  var gpsGroup     = new L.layerGroup();//  var crossGroup   = new L.layerGroup();  //オーバーレイヤー：Japan GeoJsonを２つ定義  var geoJsonColor   = new L.geoJson(japanJson, { style: style,  onEachFeature: onEachFeature  });  //日本：都道府県別カラー塗り  var geoJsonClear   = new L.geoJson(japanJson, { style: style2, onEachFeature: onEachFeature2 });  //日本：透明　塗り  var worldJsonColor = new L.geoJson(worldJson, { style: style3, onEachFeature: onEachFeature3 });  //世界：州別カラー塗り  var worldJsonClear = new L.geoJson(worldJson, { style: style4, onEachFeature: onEachFeature4 });  //世界：透明　塗り  //日本：レイヤーグループセット  geoJsonGroup.addLayer(geoJsonColor);      //日本地図データ　カラー塗（都道府県クリックポップアップ表示付き）  geoJsonGroup.addLayer(geoJsonClear);      //日本地図データ　透明　塗（都道府県クリックポップアップ表示付き）  worldJsonGroup.addLayer(worldJsonColor);  //世界地図データ　カラー塗  worldJsonGroup.addLayer(worldJsonClear);  //世界地図データ　透明　塗  //日本：県庁所在地マーカーとポップアップ　レイヤーグループセット  for (var i=0; i < prefJson.marker.length; i++){    //マーカークリック時のポップアップ設定    if (popupFlg) {      var popup = L.popup().setContent( "<center><span style='font-size:40px'>"+"【<ruby>"+"県庁所在地"+"<rt>"+"けんちょうしょざいち"+"</rt>"+"</ruby>"+ "】<br>"+"</span>"+                                      "<span style='font-size:60px'>"+"<ruby>"+prefJson.marker[i].city+"<rt>"+prefJson.marker[i].cityyomi+"</rt>"+"</ruby>"+ "<br>"+"</span></center>",                                      {maxWidth:500});    }    var mk = L.marker( [prefJson.marker[i].lat, prefJson.marker[i].lng], { draggable: false }).bindPopup(popup);    markerGroup.addLayer(mk);  }  //世界：首都マーカーとポップアップ　レイヤーグループセット  for (var i=0; i < capitalJson.marker.length; i++){    //マーカークリック時のポップアップ設定    if (popupFlg) {      var popup = L.popup().setContent( "<center><span style='font-size:40px'>"+"【<ruby>"+"首都"+"<rt>"+"しゅと"+"</rt>"+"</ruby>"+ "】<br>"+"</span>"+                                      "<span style='font-size:40px'>" + capitalJson.marker[i].capital + "<br>"+"</span></center>",                                      {maxWidth:500});    }    var mk = L.marker( [capitalJson.marker[i].lat, capitalJson.marker[i].lng], { draggable: false }).bindPopup(popup);    wdMarkerGroup.addLayer(mk);  }  // 現在地マーカーとポップアップ  var popup = L.popup().setContent("<span style='font-size:60px'>"+"<ruby>"+"現在地"+"<rt>"+"げんざいち"+"</rt>"+"</ruby>"+ "<br>"+"</span>");  var gpsMarker = L.marker( [lat, lng], { draggable: false, icon: closeIcon }).bindPopup(popup);  gpsGroup.addLayer(gpsMarker);       //gpsマーカーグループセット  // コントローラーの選択追加  var overlayLayerControls = {    "<span style='font-size:40px'>地方名色別</span>":         geoJsonColor,    "<span style='font-size:40px'>日本：選択時不透明</span>": geoJsonClear,    "<span style='font-size:40px'>現在地マーカー</span>":     gpsGroup,    "<span style='font-size:40px'>県庁所在地マーカー</span>": markerGroup,    "<span style='font-size:40px'>首都マーカー</span>":       wdMarkerGroup,    "<span style='font-size:40px'>六大州色別</span>":         worldJsonColor,    "<span style='font-size:40px'>世界：選択時不透明</span>": worldJsonClear,//    "<span style='font-size:40px'>十字マーク</span>": crossGroup,  };  //グループ初期設定  if (stateFlg) {    worldJsonColor.addTo(map);       //世界六大州  } else {    worldJsonClear.addTo(map);       //世界：選択時不透明  }  if (capitalFlg) {    wdMarkerGroup.addTo(map);       //首都マーカー  }  if (localnameFlg){    geoJsonColor.addTo(map);     //地方名別色  } else {    geoJsonClear.addTo(map);    //選択時不透明  }//  if (transparentFlg) {//    geoJsonClear.addTo(map);    //選択時不透明//  }  if (gpsmarkerFlg) {    gpsGroup.addTo(map);      //現在地マーカー  }  if (prefmarkerFlg) {    markerGroup.addTo(map);   //県庁所在地マーカー  }//  crossGroup.addTo(map);    //十字マーク  //地図選択ボタン  L.control.layers(baseMaps, overlayLayerControls, { collapsed: true,}).addTo(map);//--------------------------------------------------------------------------------------------------------------------//イベント//--------------------------------------------------------------------------------------------------------------------  //移動終了時  map.on('moveend', function(e) {//    info01.update(zoomLev);//    info01.update(centerLatLng);  // 十字マークのGPS位置を表示する    var mes = "lat: " + map.getCenter().lat + " lng: " + map.getCenter().lng;    console.log(mes);    //plugin lng,lat の位置にあるGetJsonオブジェクトを取得する//    var layer = leafletPip.pointInLayer([ map.getCenter().lng, map.getCenter().lat], geoJsonClear); //日本/*    var layer = leafletPip.pointInLayer([ map.getCenter().lng, map.getCenter().lat], worldJson);    //世界    //GeoJsonオブジェクトがあればzoomイベントを起こす    if (layer.length > 0) {      var id = layer ? layer[0].feature.properties.id : 'none';      var countryName = worldJson.marker[id].country;      console.log("layerName: "+countryName);    }*///    if (window.Unity){ Unity.call(mes); }//Unityへ送信  });//--------------------------------------------------------------------------------------------------------------------//インタラクション//--------------------------------------------------------------------------------------------------------------------  // 現在地を取得  function getgeo() {    map.on('locationerror', onLocationError);    map.locate({      setView: "true"    });  }  function onLocationError(e) {    alert(e.message);  }  //--------------------------------------------------------------------------------------------------------------------  //地方別Geojson:クリック時の動作  //--------------------------------------------------------------------------------------------------------------------  //通常表示 // 黒枠カラー塗りスタイル  function style(feature) { return { color: '#000', fillColor: getColor(feature.properties.id), weight: 1, opacity: 1, fillOpacity: 1 }; }  function getColor(id) {    var group = prefJson.marker[id-1].group;    //console.log(Group);      //デバッグ表示      return  group == "北海道地方" ? '#796BAF':              group == "東北地方"   ? '#6C9BD2':              group == "関東地方"   ? '#54C3F1':              group == "中部地方"   ? '#61C1BE':              group == "近畿地方"   ? '#69BD83':              group == "四国地方"   ? '#C1DB81':              group == "中国地方"   ? '#FFF67F':              group == "九州地方"   ? '#F9C270':                                      '#EF845C';                                      //#EF858C                                      //#EE87B4                                      //#BA79B1  }  //イベント時の挙動設定  function onEachFeature(feature, layer) {    if (popupFlg){ setInfo(layer); }    layer.on({ mouseover:  highlightFeature, mouseout:   resetHighlight, click:      zoomToFeature, });  }  //日本カラー：マウスホバー時　カラーハイライト/リセット  function highlightFeature(e) { e.target.setStyle({ color: '#000', fillColor: '#f00', weight: 1, opacity: 1, fillOpacity: 0.1}); }  //マウスホバー時　ハイライト表示　リセット  function resetHighlight(e) { geoJsonColor.resetStyle(e.target); }  //日本：クリック時のイベントとして呼ばれる　ズーム  function zoomToFeature(e) {    map.fitBounds(e.target.getBounds(), {maxZoom:8 });    //都道府県のサイズと位置にフィットしズームも自動調整される  最大バウンドズーム設定    console.log(e.target.feature.properties.pref);      //デバッグ表示    if (window.Unity){ Unity.call(e.target.feature.properties.pref); } //Unityへ送信  }  //日本：都道府県データのセット  function setInfo(layer) {    var i = layer.feature.properties.id-1;    if (i >= 0 && i < 47){      var id         = prefJson.marker[i].id;      var pref       = prefJson.marker[i].pref;//      var city       = prefJson.marker[i].city;      var group      = prefJson.marker[i].group;      var prefyomi   = prefJson.marker[i].prefyomi;//      var cityyomi   = prefJson.marker[i].cityyomi;      var LGyomi     = prefJson.marker[i].LGyomi;//      var url        = prefJson.marker[i].url;//      var addr       = prefJson.marker[i].addr;//      var lat        = prefJson.marker[i].lat;//      var lng        = prefJson.marker[i].lng;      //地方名＋都道府県名　ポップアップ　セット      layer.bindPopup ( "<center><span style='font-size:40px'>"+                        "【<ruby>" + group + "<rt>" + LGyomi + "</rt>" + "</ruby>" + "】<br>" +                        id + ":" + "<ruby>" + pref + "<rt>" + prefyomi + "</rt>" + "</ruby>" + "<br>" +                        "</span></center>"                      );    }  }  //--------------------------------------------------------------------------------------------------------------------  //日本透明:クリック時の動作  // 黒枠透明スタイル  function style2(feature) { return { color: '#000', fillColor: '#fff',                 weight: 1, opacity: 1, fillOpacity: 1 }; }  //イベント時の挙動設定  function onEachFeature2(feature, layer) {    if (popupFlg){ setInfo(layer); }    layer.on({ mouseover:  highlightFeature2, mouseout:   resetHighlight2, click:      zoomToFeature, });  }  //ハイライト  function highlightFeature2(e) { e.target.setStyle({ color: '#000', fillColor: '#f00', weight: 1, opacity: 1, fillOpacity: 0.1 }); }  //リセット  function resetHighlight2(e) { geoJsonColor.resetStyle(e.target); }  //--------------------------------------------------------------------------------------------------------------------  //世界：透明:クリック時の動作  function style3(feature) { return { color: '#000', fillColor: getColor3(feature.properties.id), weight: 1, opacity: 1, fillOpacity: 1 }; }  function getColor3(id) {    var state = capitalJson.marker[id-1].state;    //console.log(State);      //デバッグ表示      return  state == "南極"       ? '#796BAF':              state == "ヨーロッパ" ? '#6C9BD2':              state == "北アメリカ" ? '#54C3F1':              state == "アジア　"   ? '#61C1BE':              state == "南アメリカ" ? '#69BD83':              state == "オセアニア" ? '#C1DB81':              state == "アフリカ"   ? '#FFF67F':                                      '#F9C270';                                    //'#EF845C':                                    //'#EF858C':                                    //'#EE87B4':                                    //'#BA79B1':  }  //イベント時の挙動設定  function onEachFeature3(feature, layer) {    if (popupFlg){ SetInfo3(layer); }    layer.on({ mouseover:  highlightFeature3, mouseout:   resetHighlight3, click:      zoomToFeature3, });  }  //世界透明：マウスホバー時ハイライト  function highlightFeature3(e) { e.target.setStyle({ color: '#000', fillColor: '#f00', weight: 1, opacity: 1, fillOpacity: 0.1 }); }  //リセット  function resetHighlight3(e) { worldJsonColor.resetStyle(e.target); }  //世界：クリック時のイベントとして呼ばれる　ズーム  function zoomToFeature3(e) {    //map.fitBounds(e.target.getBounds(), {maxZoom:7 });    //可能な最大ズームレベルで、指定された地理的境界を含むマップビューを設定します    //map.panTo(e.target.LatLng);                           //マップを特定の中心にパンします    //map.flyTo(e.target.LatLng);                           //スムーズなパンズームアニメーションを実行するマップのビュー（地理的中心とズーム）を設定します。    //map.flyToBounds((e.target.getBounds());               //滑らかなアニメーションのようなマップのビューを設定しますが、のflyToような境界パラメータを取ります    console.log(e.target.feature.properties.a3);            //デバッグ表示    if (window.Unity){ Unity.call(e.target.feature.properties.a3); }    //Unityへ送る  }  //世界：首都データのセット  function SetInfo3 (layer) {    var i = layer.feature.properties.id-1;    if (i >= 0 && i < 211) {      var id         = capitalJson.marker[i].id;      var a3         = capitalJson.marker[i].a3;      var country    = capitalJson.marker[i].country;      var capital    = capitalJson.marker[i].capital;      var state      = capitalJson.marker[i].state;      var area       = capitalJson.marker[i].area;      var lat        = capitalJson.marker[i].lat;      var lng        = capitalJson.marker[i].lng;      //id:a3 / 【州】/ 国名 　ポップアップ　セット      layer.bindPopup ( "<center><span style='font-size:25px'>" +                        id + ":" + a3 + "<br>" +                        "【" + state + "】<br>" +                        "(" + area + ")<br>" +                        country + "<br>" +                        "</span></center>"                      );    }  }  //--------------------------------------------------------------------------------------------------------------------  //世界：透明:クリック時の動作  function style4(feature) { return { color: '#000', fillColor: '#fff',                 weight: 1, opacity: 1, fillOpacity: 1 }; }  //イベント時の挙動設定  function onEachFeature4(feature, layer) {    if (popupFlg){ SetInfo3(layer); }    layer.on({ mouseover:  highlightFeature4, mouseout:   resetHighlight4, click:      zoomToFeature3, });  }  //世界透明：マウスホバー時ハイライト  function highlightFeature4(e) { e.target.setStyle({ color: '#000', fillColor: '#f00', weight: 2, opacity: 1, fillOpacity: 0.1 }); }  //リセット  function resetHighlight4(e) { worldJsonClear.resetStyle(e.target); }//--------------------------------------------------------------------------------------------------------------------// Unityから送信されてきた時の処理//--------------------------------------------------------------------------------------------------------------------  if (window.Unity){    //Unityからロードされたjsデータが送られてくる    Unity.LoadJs = function(data){        console.log(data);    };    Unity.paramJs = function(param){      console.log(param);      //Unityから送信されてきたパラメータを分解      id             = getParam('id',             param);   //都道府県ID      maptype        = getParam('maptype',        param);   //ベース地図種類 0:地-白、1:地-標準、2:地-単色、3:地-写真、4:OSM-JP、5:OSM-ORG、6,G-標準、7:G-道路、8:G-写真、9:G-ハイブリッド      localnameFlg   = getParam('localnameFlg',   param);   //地方名色別         true:ON false:OFF      transparentFlg = getParam('transparentFlg', param);   //選択時不透明       true:ON false:OFF      gpsmarkerFlg   = getParam('gpsmarkerFlg',   param);   //現在地マーカー     true:ON false:OFF      prefmarkerFlg  = getParam('prefmarkerFlg',  param);   //県庁所在地マーカー true:ON false:OFF      popupFlg       = getParam('popupFlg',       param);   //ポップアップ表示   true:ON false:OFF      stateFlg       = getParam('stateFlg',       param);   //６大州色別         true:ON false:OFF      capitalFlg     = getParam('capitalFlg',     param);   //首都マーカー       true:ON false:OFF      var mes = id + ":" + maptype + ":" + localnameFlg + ":" + transparentFlg + ":" + gpsmarkerFlg + ":" + prefmarkerFlg + ":" + popupFlg + ":" + stateFlg + ":" + capitalFlg;//      console.log(mes);//      if (window.Unity){ Unity.call(mes); }      //現在位置から指定された都道府県へFlyToさせる      if (id >= 1 && id < 48){        //各都道府県へ        var pref  = prefJson.marker[id-1].pref;        var lat   = prefJson.marker[id-1].lat2;        var lng   = prefJson.marker[id-1].lng2;        var zoom  = prefJson.marker[id-1].zoom;        if (window.Unity){ Unity.call(lat+ ": "+lng+ ": " +zoom+ ": "+pref+ ": " + mes); }        zoom = 6;                                                     //一旦固定ズーム        map.flyTo([lat, lng], zoom , { duration: 1 });      } else {        //全国へ        if (window.Unity){ Unity.call(lat+ ": "+lng+ ": " + mes); }        map.setView([jlat, jlng], zoom);      }    }  }//--------------------------------------------------------------------------------------------------------------------  /**   * Get the URL parameter value   *   * @param  name {string} パラメータのキー文字列   * @return  url {url} 対象のURL文字列（任意）   *///--------------------------------------------------------------------------------------------------------------------  function getParam(name, url) {      if (!url) url = window.location.href;      name = name.replace(/[\[\]]/g, "\\$&");      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),          results = regex.exec(url);      if (!results) return null;      if (!results[2]) return '';      return decodeURIComponent(results[2].replace(/\+/g, " "));  }</script>